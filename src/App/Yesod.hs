{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE ViewPatterns #-}

module App.Yesod
  ( main,
    -- Suppress warning for unused top-level bindings generated by TH
    resourcesApp,
    Widget,
  )
where

import Data.Text (Text)
import Network.Wai.Handler.Warp (run)
import Yesod.Core (Yesod, mkYesod, parseRoutes, renderRoute, toWaiAppPlain)

data App = App

mkYesod
  "App"
  [parseRoutes|
  /cart/#Text/purchase CartPurchaseR POST
|]

instance Yesod App

postCartPurchaseR :: Text -> Handler Text
postCartPurchaseR cartId = do
  let response =
        mconcat
          [ "cartId: ",
            cartId,
            "\n"
          ]
  pure response

main :: IO ()
main = do
  app <- toWaiAppPlain App
  let port = 3000
  run port app
